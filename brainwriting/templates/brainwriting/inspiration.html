{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Inspiration - levant√©!</title>
    <link rel="stylesheet" href="{% static 'inspirationn.css' %}">

</head>

<body>

    <input id="problem-description" type="text" size="100"><br>
    <div id="idea-container">
        <input type="text" id="idea-one">
        <input type="text" id="idea-two">
        <input type="text" id="idea-three">
    </div>
    <h3 id="checkideas-text">Check out some other ideas!</h3><br>
    <div>You have <span id="time">30</span> seconds!</div>


    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        var token = '{{csrf_token}}';
        //Get problem description
        $.ajax({
            type: 'GET',
            headers: { "X-CSRFToken": token },
            url: '/get_question/',
            data: {
                room_id: localStorage.getItem('roomId')
            },
            success: function (response) {
                document.querySelector('#problem-description').value = response;
            },
        });
        // Loads the first three ideas
        loadNextIdeas();

        function getIdeas() {
            const roomId = localStorage.getItem('roomId');
            return $.ajax({
                type: 'GET',
                headers: { "X-CSRFToken": token },
                url: '/get_responses/',
                data: {
                    page: 'inspiration',
                    room_id: roomId,
                },
                success: function(response) {
                    if (response == "NULL869" || response == "none")
                    {
                        return;
                    }
                    return response;
                },
            });
        }

        async function loadNextIdeas() {
            const ideaElements = ['idea-one', 'idea-two', 'idea-three'];

            let ideas = await getIdeas();
            ideas = JSON.parse(ideas);
            // TODO: pick ideas randomly instead of in order
            // TODO: only get ideas that came from other users
            for (let i = 0; i < 3 ; i++) {
                if (ideas[i]) {
                    document.getElementById(ideaElements[i]).value = ideas[i].fields.response_text;
                }
            }
        }
        function startTimer(duration, display) {
            var timer = duration, minutes, seconds;
            setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = seconds; //minutes + ":" + seconds;
                if (--timer < 0) {
                    window.location.pathname = window.location.pathname.split("inspiration")[0] + '2/';
                }
            }, 1000);
        }

        window.onload = function () {
            display = document.querySelector('#time');
            startTimer(15, display); //switch to 30 seconds
        };
    </script>
</body>

</html>