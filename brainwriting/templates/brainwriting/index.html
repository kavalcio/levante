{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Home Page - levant√©!</title>
    <link rel="stylesheet" href="{% static 'index.css' %}">
</head>

<body>
    <div id="main-container">
        <img id="logo-image" src="{%  static 'images/logo.png' %}" alt="">
        <div id="sub-container">
            <input id="room-name-input" type="text" value="Enter Key" onclick=clearText()> <br>
            <input id="room-name-submit" type="button" value="Begin"><br>
            <div id="bottom-inputs">
                <input id="log-in" type="button" value="Log In/Sign Up"><br>
                <input id="create-room" type="button" value="Create New Room">
                <input id="start-tutorial" type="button" value="Start Tutorial">
            </div>
        </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        var token = '{{csrf_token}}';
        //simply clears the text for the Key to be entered
        function clearText() {
            if( document.querySelector('#room-name-input').value== "Enter Key")
                document.querySelector('#room-name-input').value = ""
        }
        function createRoom(isTutorial) {
            $.ajax({
                type: 'POST',
                headers: { "X-CSRFToken": token },
                url: '/create_room/',
                data: {
                    is_tutorial: isTutorial ? 'True' : 'False',
                },
                success: function (response) {
                    response = JSON.parse(response);
                    const roomKey =  response[0].fields.room_key;
                    localStorage.setItem('roomId', response[0].pk);

                    const isTutorial = response[0].fields.is_tutorial === 'True' ? true : false;
                    localStorage.setItem('isTutorial', isTutorial);
                    window.location.pathname = '/rooms/' + roomKey + '/admin/create';
                },
            });
        }
        function joinRoom(roomKey) {
            $.ajax({
                type: 'POST',
                headers: { "X-CSRFToken": token },
                url: '/join_room/',
                data: {
                    roomKey: roomKey,
                },
                success: function (response) {
                    const roomExists = response;
                    if (roomExists == 1) {
                        var user = Math.floor(Math.random() * 100)
                        window.location.pathname = '/rooms/' + roomKey + '/' + user + '/1/';
                    } else {
                        alert('room not found');
                    }
                },
            });
        }

        document.querySelector('#create-room').onclick = async function (e) {
            createRoom();
        };
        document.querySelector('#room-name-submit').onclick = function (e) {
            // Check if room exists
            var roomName = document.querySelector('#room-name-input').value;
            joinRoom(roomName);
        }
        document.querySelector('#start-tutorial').onclick = async function(e) {
            const isTutorial = true;
            createRoom(isTutorial);
        };
    </script>
</body>
</html>