<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Home Page - levanté!</title>
    </head>
    <body>
        <h1>levanté!</h1>
        <input id="room-name-input" type="text" size="100" value = "Enter Key" onclick=clearText()> <br>
        <input id="room-name-submit" type="button" value="Begin"><br>
        <input id="log-in" type="button" value="Log In/Sign Up"><br>
        <input id="create-room" type="button" value="Create New Room">
        <input id="start-tutorial" type="button" value="Start Tutorial">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script>
            //simply clears the text for the Key to be entered
            function clearText(){
                document.querySelector('#room-name-input').value = ""
            }
            function createRoom(isTutorial = false) {
                $.ajax({
                    type: 'POST',
                    url: '/create_room/',
                    data: {
                        is_tutorial: isTutorial ? 'True' : 'False',
                    },
                    success: function(response) {
                        response = JSON.parse(response);
                        const roomKey =  response[0].fields.room_key;
                        localStorage.setItem('roomId', response[0].pk);

                        const isTutorial = response[0].fields.is_tutorial === 'True' ? true : false;
                        localStorage.setItem('isTutorial', isTutorial); // TODO: Is this necessary?
                        window.location.pathname = '/rooms/' + roomKey + '/admin/create';
                    },
                });
            }
            function joinRoom(roomKey) {
                $.ajax({
                    type: 'POST',
                    url: '/join_room/',
                    data: {
                        roomKey: roomKey,
                    },
                    success: function(response) {
                        const roomExists =  response;
                        if (roomExists == 1) {
                            var user = Math.floor(Math.random()*100)
                            window.location.pathname = '/rooms/' + roomKey + '/'+user+'/1/';
                        } else {
                            alert('room not found');
                        }
                    },
                });
            }

            document.querySelector('#create-room').onclick = async function(e) {
                createRoom();
            };
            document.querySelector('#room-name-submit').onclick = function(e) {
                // Check if room exists
                const roomName = document.querySelector('#room-name-input').value;
                joinRoom(roomName);        
            }
            document.querySelector('#start-tutorial').onclick = async function(e) {
                const isTutorial = true;
                createRoom(isTutorial);
            };
        </script>
    </body>
</html>