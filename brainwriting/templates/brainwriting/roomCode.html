{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Room Code - levant√©!</title>
    <link rel="stylesheet" href="{% static 'roomCode.css' %}">
</head>

<body>
    <div id="main-container">

        <img id="logo-image" src="{%  static 'images/logo.png' %}" alt="">
        <div id="sub-container">
            <h3 id="key-share">Your Key to Share</h3>
            <br>

            <input type="text" value="room code" id="myInput" onclick="copyFunction()"><br>

            {{ room_name|json_script:"room-name" }}
        </div>
        <div id="enter-room-center">
            <input id="join-room" type="button" value="Enter Room" onclick="joinRoom()">
        </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        var token = '{{csrf_token}}';
        // update room code  
        const roomName = JSON.parse(document.getElementById('room-name').textContent);
        document.getElementById("myInput").value = roomName;
        //called when copy button is clicked to copy text to clipboard and create a popup 
        function copyFunction() {
            /* Get the text field */
            var copyText = document.getElementById("myInput");

            /* Select the text field */
            copyText.select();

            /* Alert the copied text */
            alert("Copied link: " + copyText.value);
        }
        function joinRoom() {
            $.ajax({
                type: 'POST',
                headers: { "X-CSRFToken": token },
                url: '/join_room/',
                data: {
                    roomKey: roomName,
                },
                success: function (response) {
                    if (response !== 'None') {
                        const roomObj = JSON.parse(response);
                        // TODO: make sure user number doesn't already exist
                        // TODO: keep track of joined users in the backend
                        localStorage.setItem('roomId', roomObj[0].pk);
                        localStorage.setItem('isTutorial', roomObj[0].fields.is_tutorial);
                        var user = Math.floor(Math.random() * 100)
                        window.location.pathname = '/rooms/' + roomName + '/' + user + '/1/';
                    } else {
                        alert('room not found');
                    }
                },
            });
        }
    </script>
</body>
</html>