{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Home Page - levant√©!</title>
    <link rel="stylesheet" href="{% static 'roomCode.css' %}">
</head>

<body>
    <div id="main-container">

        <img id="logo-image" src="{%  static 'images/logo.png' %}" alt="">
        <div id="sub-container">
            <h3 id="key-share">Your Key to Share</h3>
            <br>
            <h2 id="key-no">0424013</h2>

            <!-- Commented this input because it wasn't in Tim's mockup. 
              <input type="text" value="room code" id="room-code" onclick="copyFunction()"><br> -->
            {{ room_name|json_script:"room-name" }}
        </div>
        <input id="join-room" type="button" value="Enter Room" onclick="joinRoom()">

    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        var token = '{{csrf_token}}';
        // update room code  
        const roomName = JSON.parse(document.getElementById('room-name').textContent);
        document.getElementById("myInput").value = roomName;
        //called when copy button is clicked to copy text to clipboard and create a popup 
        function copyFunction() {
            /* Get the text field */
            var copyText = document.getElementById("myInput");

            /* Select the text field */
            copyText.select();

            /* Copy the text inside the text field */
            document.execCommand("copy");

            /* Alert the copied text */
            alert("Copied link: " + copyText.value);
        }
        function joinRoom() {
            $.ajax({
                type: 'POST',
                headers: { "X-CSRFToken": token },
                url: '/join_room/',
                data: {
                    roomKey: roomName,
                },
                success: function (response) {
                    const roomExists = response;
                    if (roomExists == 1) {
                        var user = Math.floor(Math.random() * 100)
                        window.location.pathname = '/rooms/' + roomName + '/' + user + '/1/';
                    } else {
                        alert('room not found');
                    }
                },
            });
        }

        document.querySelector('#create-room').onclick = async function (e) {
            createRoom();
        };
        document.querySelector('#room-name-submit').onclick = function (e) {
            // Check if room exists
            var roomName = document.querySelector('#room-name-input').value;
            joinRoom(roomName);
        }
    </script>
</body>

</html>