<html>
    <head>
        <head>
            <meta charset="utf-8"/>
            <title>Brain Room</title>
        </head>
    </head>
    <body>
        <h2>Vote For In Person Discussion!</h2><br>
        <textarea readonly id="idea-one" cols="50" rows="20" onclick="vote('one')"></textarea>
        <textarea readonly id="idea-two" cols="50" rows="20" onclick="vote('two')"></textarea>
        <textarea readonly id="idea-three" cols="50" rows="20" onclick="vote('three')"></textarea><br>
        <button onclick="loadThreeNext()"> Next Ideas</button>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script>
            let currentIdea = null;

            // Loads the first three ideas
            loadNextIdea("one", true)
            loadNextIdea("two", true)
            loadNextIdea("three", true)

            function vote(ideaNum){
                const idea = document.getElementById("idea-"+ideaNum).value
                    $.ajax({
                        type: 'POST',
                        url: '/upd_response/',
                        data: {
                            response: idea,
                            check: "vote"
                        },
                        success: function(response) {
                            alert(response);
                        },
                    });
                document.getElementById("idea-"+ideaNum).value = "Voted!"
            }

            function loadNextIdea(ideaNum, firstRun) {
                const idea = document.getElementById("idea-"+ideaNum).value
                if(document.getElementById("idea-"+ideaNum).value != "Voted!" && !firstRun){
                    $.ajax({
                        type: 'POST',
                        url: '/upd_response/',
                        data: {
                            response: idea,
                            check: "no"
                        },
                        success: function(response) {
                            alert(response);
                        },
                    });  
                }
                $.ajax({
                    type: 'GET',
                    url: '/get_response/voting',
                    success: function(response) {
                        currentIdea = response;
                        if(response == "NULL869" || response == "none")
                            window.location.pathname = window.location.pathname.split("voting")[0] + 'end/';
                        else 
                            document.getElementById("idea-"+ideaNum).value = response;
                    },
                });
            }

            function loadThreeNext(){
                loadNextIdea("one", false)
                loadNextIdea("two", false)
                loadNextIdea("three", false)
            }
        </script>
    </body>
</html>